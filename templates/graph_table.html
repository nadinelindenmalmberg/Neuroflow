<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>View/Edit Table - {{ graph.name }}</title>
  </head>
  <body>
    <p><a href="{{ url_for('dashboard') }}">Back to Dashboard</a></p>
    <a href="{{ url_for('add_data') }}">Add Data Point</a>
    <form method="POST">
      <h1>
        <input
          type="text"
          name="graph_name_{{ graph.id }}"
          value="{{ graph.name }}"
        />
      </h1>
      <table border="1">
        <thead>
          <tr>
            <th>Date (YYYY-MM-DD)</th>
            <th>Metric Name</th>
            <th>Value</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for dp in data_points %}
          <tr>
            <!-- Hidden field to track DataPoint ID when saving edits -->
            <input type="hidden" name="data_point_id" value="{{ dp.id }}" />
            <td>
              <input
                type="text"
                name="date_{{ dp.id }}"
                value="{{ dp.date.strftime('%Y-%m-%d') }}"
                required
              />
            </td>
            <td>
              <input
                type="text"
                name="metric_name_{{ dp.id }}"
                value="{{ dp.metric_name }}"
                required
              />
            </td>
            <td>
              <input
                type="number"
                step="any"
                name="value_{{ dp.id }}"
                value="{{ dp.value }}"
                required
              />
            </td>
            <td>
              <!-- Separate form for deleting a single row -->
              <form
                action="{{ url_for('delete_datapoint', data_point_id=dp.id) }}"
                method="POST"
                style="display: inline"
              >
                <button
                  type="submit"
                  onclick="return confirm('Are you sure you want to delete this data point?');"
                >
                  Delete Row
                </button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <button type="submit">Save Changes</button>
    </form>
  </body>
</html>
